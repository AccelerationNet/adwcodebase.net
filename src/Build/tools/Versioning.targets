<?xml version="1.0" encoding="utf-8"?>
<Project ToolsVersion="4.0" xmlns="http://schemas.microsoft.com/developer/msbuild/2003">

  <PropertyGroup>
    <VersionFileDirectory>Properties\</VersionFileDirectory>
    <VersionFile>$(VersionFileDirectory)Version.generated.cs</VersionFile>
    <GitExecutable>&quot;C:\Program Files (x86)\Git\bin\git.exe&quot;</GitExecutable>
    <GitDescribeCommand>$(GitExecutable) describe --tags --dirty --long --candidates 1</GitDescribeCommand>
  </PropertyGroup>

  <Target Name="_GitDescribe" Returns="DescribeOutput">
    <Exec Command="$(GitDescribeCommand)" ConsoleToMSBuild="true">
      <Output TaskParameter="ConsoleOutput" PropertyName="DescribeOutput"/>
    </Exec>
    <Message Text="$(GitDescribeCommand): '$(DescribeOutput)'"/>
  </Target>

  <Target Name="UpdateAssemblyInformationalVersion"
	  DependsOnTargets="_GitDescribe"
	  BeforeTargets="BeforeBuild">
    <ItemGroup>
      <AssemblyAttributes Include="AssemblyInformationalVersion">
	<_Parameter1>$(DescribeOutput)</_Parameter1>
      </AssemblyAttributes>
    </ItemGroup>
    <MakeDir Directories="$(VersionFileDirectory)"/>
    <WriteCodeFragment Language="C#" OutputFile="$(VersionFile)"
		       AssemblyAttributes="@(AssemblyAttributes)" />
    <ItemGroup>
      <Compile Include="$(VersionFile)"/>
    </ItemGroup>
  </Target>
</Project>
